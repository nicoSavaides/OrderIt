<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Ensure the body takes up the full viewport height */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }





    body {
      font-family: "Lora", sans-serif;
      text-align: center;
      background-color: #e9ece6;
      color: #000000;
      display: flex;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
    }



    #welcomeScreen h1 {
      font-size: 4rem;
      font-weight: bold;
      line-height: .3;
    }



    #welcomeScreen p {
      font-size: 1.5rem;
      margin-top: 10px;
      line-height: 1.5;
    }


    #gameScreen h2 {
      font-size: 3rem;  /* Adjust this value as needed */
    }



    .hidden {
      display: none;
    }

    button {
      font-size: 1.2rem;
      background-color: #000000;
      color: #FFFFFF;
      padding: 10px 20px;
      margin-top: 150px;
      cursor: pointer;
      border-radius: 40px;
    }

    #itemList {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 150px;
      padding: 0;
      list-style: none;
    }

    @font-face {
      font-family: 'Milk And Honey';
      src: url('orderItFont.ttf') format('truetype');
    }

    h1, h2, h3 {
      font-family: 'Milk And Honey', sans-serif;
    }

    @font-face {
      font-family: 'Lora';
      src: url('Lora.ttf') format('truetype');
    }

    p {
      font-family: 'Lora', sans-serif;
    }

    .draggable-item {
      padding: 10px;
      margin: 5px;
      background-color: #CCCCCC;
      border: 1px solid #ccc;
      cursor: grab;
      font-weight: 900;
      width: 300px;
      max-width: 400px;
      box-sizing: border-box;
      text-align: center;
    }

    .drag-over {
      border: 2px dashed #333;
    }

    #gameStatus {
      position: absolute;
      top: 20%; /* Adjust this to move it up/down */
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      color: #000000;
      font-family: 'Milk And Honey', sans-serif;
      text-align: center;
    }

    /* DATE */
    #currentDate {
      font-size: 1rem;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
    }

    #endScreen p {
      font-size: 1.5rem;
      margin-top: 150px;
    }




















    @media (max-width: 480px) {
      /* Further adjustments for smaller screens (smartphones) */
      h1 {
        font-size: 2.5rem !important; 
        margin-top: 14px !important
      }

      h2 {
        font-size: 2rem !important;
      }


      p {
        padding-top: 90px !important;
        font-size: 1rem !important;
        font-weight: 400 !important;

       }

       

      button {
        font-size: 1.5rem;
        padding: 12px 25px;
        margin-top: 20px;
      }





      .draggable-item {
        font-size: 1.5rem; /* Larger draggable items */
        width: 90%;
      }

      #strikeCount {
        font-size: 1.5rem; /* Adjust strike count font size */
        margin-top: -85px !important; 
        
      }


      #submitWrapper {
      margin-top: 14px; /* <-- You can lower this number to move it closer to the list */
      }

      #submitWrapper button {
      margin-top: 0; /* Remove the big margin that button normally has */
      }

          .correct-order-label {
      font-weight: bold;
      font-size: 1.2rem !important;
      text-align: center;

      position: relative;
      top: 20px; /* Adjust this value to move only the text down */
      margin: 0;
    }


      
      .correct-order-tile {
      transform: translateY(-50px); /* Move up by 10px */
      transition: transform 0.3s ease; /* Smooth animation */
      }



    



      /* LIST */
      #itemList {
        width: 100%;
        margin-top: 110px;
      }

      #endGameStatus {
      font-size: 2.2rem !important; /* Adjust this size as needed for mobile */
      font-weight: bold;
      color: #000;
      text-align: center;
      margin-top: 20px !important;
    }

      #finalScore {
        margin-top: -100px !important;
        font-size: 1.2rem !important;
      }

      #thanksMessage {
        
      position: relative;
      top: -50px !important;
      text-align: center;
      font-size: 1.2rem !important;
    }



      #shareLink,
      #shareButton {
        margin-top: -50px !important;
      }


      
      #currentDate {
        margin-top: 0px;
        font-size: .8rem !important;

      }

      .hidden {
    display: none !important;
  }


 
  



    }


    /* GIF */
    .mobile-logo {
      margin-top: 10px !important;
      width: 200px; /* Default size */
      height: 100px; /* Default size */
      margin-left: 11px;
      
    
}





#gameStatus {
  display: block !important;
  pointer-events: none;
}




#gameStatus {
  display: block !important;
  background-color: #ffcc00; /* Just to make it visible */
  color: #000;
  font-size: 2rem;
}









    





  </style>
</head>
<body>
  <!-- Your body content here -->
</body>


  <div id="welcomeScreen">
    <div>

      <img src="movingLogo.gif" alt="Moving Logo" class="mobile-logo">



      <h1>Order It.</h1>
      <p>Drag the items into the correct order based on the given category. The item with the lowest value (smallest, shortest, lightest, etc.) should go at the top. 
        The item with the highest value (largest, tallest, heaviest, etc.) should go at the bottom. 3 rounds. 3 mistakes allowed.</p>
      <button onclick="startGame()">Play</button>
    </div>
  </div>












  <div id="gameScreen" class="hidden">
    <h2 id="roundPrompt">Order by:</h2>
    <p id="gameStatus"></p>
    <ul id="itemList"></ul>

    <p id="strikeCount">Strikes: 0/3</p>

    <div id="submitWrapper">
      <button onclick="submitOrder()">Submit</button>
    </div>

   
   
  </div>
  
  <div id="endScreen" class="hidden">
    <p id="endGameStatus"></p>
    <p id="finalScore"></p> <!-- their score will appear here -->
    <p id="thanksMessage">Thanks for playing. Come back tomorrow for a new Order It!</p>
    <button id="shareButton">Share your score</button> <!-- share button -->
    <p id="shareLink" style="word-break: break-all;"></p> <!-- link will show up here -->
  </div>
  
  <p id="currentDate"></p>
  
  <script>
    let currentRound = 0;
    let rounds = [];
    let strikes = 0;
    const maxStrikes = 3;
  
    function startGame() {
      document.getElementById('welcomeScreen').classList.add('hidden');
      document.getElementById('gameScreen').classList.remove('hidden');
  
      fetch("rounds.json")
        .then(res => res.json())
        .then(data => {
          rounds = data.days[0];
          loadRound();
        });
    }
  
    function displayCurrentDate() {
      const now = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      const formattedDate = now.toLocaleDateString(undefined, options);
      document.getElementById('currentDate').textContent = `${formattedDate}`;
    }
  
    displayCurrentDate();
  
    function loadRound() {
      if (currentRound >= rounds.length) {
        endGame();
        return;
      }
  
      
      
      
      
      
      
      
      
      const { prompt, items } = rounds[currentRound];
      document.getElementById('roundPrompt').textContent = "Order by: " + prompt;
  
      const itemList = document.getElementById('itemList');
  
      if (currentRound === 0) {
        items.forEach(item => {
          const li = document.createElement('li');
          li.textContent = item;
          li.setAttribute('draggable', true);
          li.classList.add('draggable-item');
          itemList.appendChild(li);
        });
      }
  
      updateStrikes();
      makeItemsDraggable();
    }



    function makeItemsDraggable() {
  const items = document.querySelectorAll('.draggable-item');
  let draggedItem = null;
  let draggedItemInitialPosition = { x: 0, y: 0 };
  let offsetX = 0;
  let offsetY = 0;

  // Desktop (Mouse) Events
  items.forEach(item => {
    item.addEventListener('dragstart', (e) => {
      draggedItem = item;
      draggedItemInitialPosition = { x: e.pageX, y: e.pageY };

      // Add class for visual feedback and make it semi-transparent
      draggedItem.classList.add('dragging');
      setTimeout(() => {
        draggedItem.style.opacity = '0.5'; // Make the dragged item semi-transparent
      }, 0);
    });

    item.addEventListener('dragover', (e) => {
      e.preventDefault();  // Allow the tile to be dropped, but do not change position during drag
    });

    item.addEventListener('dragenter', (e) => {
      e.preventDefault();  // Allow the hover effect to apply
    });

    item.addEventListener('dragend', () => {
      // Reset after drag ends
      draggedItem.style.opacity = ''; // Reset opacity
      draggedItem.classList.remove('dragging'); // Remove dragging class
      draggedItem = null; // Clear reference to the dragged item
    });

    item.addEventListener('drop', () => {
      // Reorder the tiles only after the item is dropped
      if (draggedItem !== item) {
        const list = item.parentNode;
        const draggedIndex = Array.from(list.children).indexOf(draggedItem);
        const droppedIndex = Array.from(list.children).indexOf(item);

        // Only reorder after the item is dropped
        if (draggedIndex < droppedIndex) {
          list.insertBefore(draggedItem, item.nextSibling);
        } else {
          list.insertBefore(draggedItem, item);
        }
      }

      // Reset dragged item after drop
      draggedItem.style.opacity = '';
      draggedItem.classList.remove('dragging');
      draggedItem = null;
    });
  });

  // Mobile (Touch) Events
  items.forEach(item => {
    item.addEventListener('touchstart', (e) => {
      e.preventDefault();  // Prevent default touch behavior
      draggedItem = item;
      draggedItemInitialPosition = {
        x: e.touches[0].pageX,
        y: e.touches[0].pageY,
      };

      // Add class for visual feedback
      draggedItem.classList.add('dragging');
      setTimeout(() => {
        draggedItem.style.opacity = '0.5'; // Make the dragged item semi-transparent
      }, 0);
    });

    item.addEventListener('touchmove', (e) => {
      e.preventDefault();  // Prevent default touch behavior

      // Calculate how far the touch has moved
      const touch = e.touches[0];
      offsetX = touch.pageX - draggedItemInitialPosition.x;
      offsetY = touch.pageY - draggedItemInitialPosition.y;

      // Update the position of the dragged item
      draggedItem.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
    });

    item.addEventListener('touchend', (e) => {
      // After touch ends, reset the position
      draggedItem.style.transform = ''; // Reset position after release
      draggedItem.style.position = ''; // Reset positioning
      draggedItem.style.opacity = ''; // Reset opacity

      // Check where the item should be placed and reorder
      const allItems = Array.from(document.querySelectorAll('.draggable-item'));
      allItems.forEach((otherItem) => {
        if (otherItem === draggedItem) return;

        const rect = otherItem.getBoundingClientRect();
        if (e.changedTouches[0].pageY > rect.top && e.changedTouches[0].pageY < rect.bottom) {
          const list = draggedItem.parentNode;
          const draggedIndex = Array.from(list.children).indexOf(draggedItem);
          const droppedIndex = Array.from(list.children).indexOf(otherItem);

          // Reorder only after dropping the dragged item
          if (draggedIndex < droppedIndex) {
            list.insertBefore(draggedItem, otherItem.nextSibling);
          } else {
            list.insertBefore(draggedItem, otherItem);
          }
        }
      });

      // Reset dragged item state
      draggedItem.classList.remove('dragging');
      draggedItem = null;
    });

    item.addEventListener('touchcancel', () => {
      draggedItem.style.transform = ''; // Reset position if canceled
      draggedItem.style.position = ''; // Reset positioning if canceled
      draggedItem.style.opacity = ''; // Reset opacity if canceled
      draggedItem.classList.remove('dragging'); // Remove dragging class
      draggedItem = null;
    });
  });
}





let roundsCompleted = 0; // Track how many rounds the player has completed successfully.

function submitOrder() {
  const itemList = document.getElementById('itemList');
  const submittedOrder = Array.from(itemList.children).map(li => li.textContent);
  const correctOrder = rounds[currentRound].correctOrder;

  if (JSON.stringify(submittedOrder) === JSON.stringify(correctOrder)) {
    roundsCompleted++; // Increment rounds completed on correct order.
    currentRound++;
    if (currentRound < rounds.length) {
      loadRound();
    } else {
      // If all rounds are completed without exceeding max strikes
      if (strikes < maxStrikes) {
        setTimeout(endGame, 500); // Wait for a moment, then end the game
      } else {
        document.getElementById('gameStatus').textContent = "Nice!"; // Fallback message if there are strikes
      }
    }
  } else {
    strikes++;
    document.getElementById('strikeCount').textContent = `Strikes: ${strikes}/${maxStrikes}`;

    if (strikes >= maxStrikes) {
      const itemList = document.getElementById('itemList');
      itemList.innerHTML = '';

      // Create the label and add the class instead of inline styles
      const label = document.createElement('p');
      label.textContent = 'Correct Order:';
      label.classList.add('correct-order-label');  // Add the CSS class here

      itemList.parentNode.insertBefore(label, itemList);

      correctOrder.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        li.classList.add('draggable-item');
        li.classList.add('correct-order-tile');
        li.style.backgroundColor = '#555555';
        li.style.fontWeight = 'bold';
        li.style.cursor = 'default';
        li.setAttribute('draggable', false);
        itemList.appendChild(li);
      });

      document.querySelector("button[onclick='submitOrder()']").disabled = true;
      document.querySelector("button[onclick='submitOrder()']").style.display = 'none';

      setTimeout(() => {
        label.remove();
        endGame();
      }, 5000);
    }
  }
}


  
    function updateStrikes() {
      document.getElementById('strikeCount').textContent = `Strikes: ${strikes}/${maxStrikes}`;
    }








    
    let score = 0; // you should already be tracking this
   


    function endGame() {
  console.log("End game triggered");  // Test if this is being reached
  document.getElementById('gameScreen').classList.add('hidden'); // Hide the game screen
  document.getElementById('endScreen').classList.remove('hidden'); // Show the end screen

  let message = "";  // Default message

  // Set message based on the rounds completed
  if (roundsCompleted === 3) {
    message = "Amazing!";
  } else if (roundsCompleted === 2) {
    message = "Good job!";
  } else if (roundsCompleted === 1) {
    message = "Not bad";
  } else {
    message = "Nice try";
  }

  // Update the end game status message
  document.getElementById('endGameStatus').textContent = message;

  // Show the player's final score
  document.getElementById('finalScore').textContent = `You scored ${roundsCompleted} out of ${rounds.length}`;

  // Set up the share button
  const shareButton = document.getElementById('shareButton');
  shareButton.onclick = function() {
    generateShareLink();
  };
}









function generateShareLink() {
  // Create a simple shareable link with score in the URL
  const baseUrl = window.location.origin + window.location.pathname; // current page
  const shareUrl = `${baseUrl}?score=${score}`;

  const shareLink = document.getElementById('shareLink');
  shareLink.innerHTML = `<a href="${shareUrl}" target="_blank">${shareUrl}</a>`;

  // Optionally, automatically copy to clipboard:
  navigator.clipboard.writeText(shareUrl).then(() => {
    alert('Link copied to clipboard!');
  });
}

// If you want, you can ALSO read the ?score= part of URL and display it when someone clicks a shared link!
window.onload = function() {
  const urlParams = new URLSearchParams(window.location.search);
  const sharedScore = urlParams.get('score');
  if (sharedScore !== null) {
    alert(`Your friend's score: ${sharedScore}/3`);
  }
};


    const date = new Date().toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    document.getElementById('currentDate').textContent = date;
  </script>

</body>
</html>
